include:
  - project: TankerHQ/gitlab-ci-files
    ref: cc820822bc646de30fd3f2f01304ea4a6f23b72d
    # TODO replace with react-native.yml later on
    file: /common.yml

##########
# Stages #
##########

stages:
  - check

########
# Jobs #
########

default:
  before_script:
    # TODO: should be done by the include script above I think
    - poetry install

check/ios/dummy:
  stage: check
  extends:
    - .tags/macos
    - .rules/mr/auto
  script:
    - yarn
    - yarn test

check/android/deployed:
  stage: check
  extends:
    - .tags/linux
    - .rules/mr/auto
  script:
    - sudo chgrp 1000 -f /dev/kvm
    - poetry run python run-ci.py build-and-test
  image: registry.gitlab.com/tankerhq/docker/sdk-react-native:latest
